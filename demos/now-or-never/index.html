<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TIME IS RUNNING OUT</title>
    <style>
      :root {
        --bg: #0a0a0a;
        --accent: #ff0000;
        --break: #00ff41; /* Matrix green for rest */
        --text: #ffffff;
      }

      body {
        background-color: var(--bg);
        color: var(--text);
        font-family: "Courier New", Courier, monospace;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        margin: 0;
        text-transform: uppercase;
        overflow-y: auto;
        padding: 20px;
        transition: background-color 0.5s ease;
      }

      .container {
        text-align: center;
        border: 2px solid var(--accent);
        padding: 2rem;
        box-shadow: 0 0 20px rgba(255, 0, 0, 0.2);
        max-width: 600px;
        width: 100%;
        margin-bottom: 20px;
        transition:
          opacity 0.5s ease,
          transform 0.5s ease;
      }

      /* Dimming Logic */
      body.active-pomo .deadline-section,
      body.active-pomo .warning,
      body.active-pomo h1 {
        opacity: 0.15; /* Dims non-pomo elements */
        pointer-events: none; /* Prevents distraction/interaction */
      }

      body.active-pomo .container {
        border-color: rgba(255, 0, 0, 0.1);
      }

      /* Pomodoro Specific Styles */
      .pomo-container {
        border: 2px solid var(--text);
        padding: 1.5rem;
        margin-top: 20px;
        background: #111;
        position: relative;
        z-index: 10;
        transition: box-shadow 0.3s ease;
      }

      body.active-pomo .pomo-container {
        box-shadow: 0 0 30px rgba(255, 255, 255, 0.1);
        border-color: var(--text);
        opacity: 1 !important;
      }

      #pomo-status {
        font-size: 1.2rem;
        color: var(--accent);
        margin-bottom: 10px;
        font-weight: bold;
      }

      #pomo-timer {
        font-size: 4rem;
        margin: 0.5rem 0;
      }

      .pomo-controls button {
        background: transparent;
        border: 1px solid var(--text);
        color: var(--text);
        padding: 10px 20px;
        cursor: pointer;
        font-family: inherit;
        text-transform: uppercase;
        transition: 0.3s;
      }

      .pomo-controls button:hover {
        background: var(--text);
        color: var(--bg);
      }

      h1 {
        font-size: 1.5rem;
        letter-spacing: 5px;
        margin-bottom: 2rem;
        color: var(--accent);
        animation: blink 1s infinite;
      }

      #countdown {
        font-size: 4rem;
        font-weight: bold;
        margin: 1rem 0;
      }

      .label {
        font-size: 0.8rem;
        color: #666;
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-bottom: 20px;
      }

      .warning {
        margin-top: 2rem;
        font-size: 0.9rem;
        line-height: 1.5;
      }

      input[type="datetime-local"] {
        background: #222;
        color: white;
        border: 1px solid var(--accent);
        padding: 10px;
        margin-bottom: 20px;
        font-family: inherit;
      }

      @keyframes blink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.3;
        }
      }

      .expired {
        color: var(--accent);
        animation: shake 0.5s infinite;
      }

      @keyframes shake {
        0% {
          transform: translate(1px, 1px);
        }
        20% {
          transform: translate(-3px, 0px);
        }
        40% {
          transform: translate(3px, 2px);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 id="main-title">Final Deadline Imminent</h1>

      <div class="deadline-section">
        <input
          type="datetime-local"
          id="deadlineInput"
          onchange="updateDeadline()"
        />
        <div id="countdown">00:00:00:00</div>
        <div class="label">
          <span>Days</span><span>Hrs</span><span>Min</span><span>Sec</span>
        </div>
      </div>

      <div class="pomo-container">
        <div id="pomo-status">WORK SESSION 1/4</div>
        <div id="pomo-timer">25:00</div>
        <div class="pomo-controls">
          <button id="pomo-start-btn" onclick="togglePomo()">
            Start Cycle
          </button>
          <button onclick="resetPomo()">Reset</button>
        </div>
      </div>

      <div class="warning">
        The clock does not care about your excuses. Every second you spend
        looking at this screen is a second stolen from your future.
        <br /><strong>GET TO WORK.</strong>
      </div>
    </div>

    <script>
      /* --- MAIN DEADLINE LOGIC --- */
      let deadline = new Date(
        localStorage.getItem("studyDeadline") ||
          new Date().getTime() + 86400000,
      );
      const inputField = document.getElementById("deadlineInput");
      const tzOffset = deadline.getTimezoneOffset() * 60000;
      inputField.value = new Date(deadline - tzOffset)
        .toISOString()
        .slice(0, 16);

      function updateDeadline() {
        const inputVal = document.getElementById("deadlineInput").value;
        if (inputVal) {
          deadline = new Date(inputVal);
          localStorage.setItem("studyDeadline", inputVal);
        }
      }

      function updateTimer() {
        const now = new Date().getTime();
        const distance = deadline - now;
        if (distance < 0) {
          document.getElementById("countdown").innerText = "TIME EXPIRED";
          document.getElementById("countdown").classList.add("expired");
          return;
        }
        const days = Math.floor(distance / (1000 * 60 * 60 * 24))
          .toString()
          .padStart(2, "0");
        const hours = Math.floor(
          (distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60),
        )
          .toString()
          .padStart(2, "0");
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60))
          .toString()
          .padStart(2, "0");
        const seconds = Math.floor((distance % (1000 * 60)) / 1000)
          .toString()
          .padStart(2, "0");
        let timeStr = `${days}:${hours}:${minutes}:${seconds}`;
        document.getElementById("countdown").innerText = timeStr;
        document.title = `${timeStr} ⚠️ STUDY NOW`;
      }

      /* --- POMODORO LOGIC --- */
      const sequence = [
        { type: "WORK", time: 25 },
        { type: "BREAK", time: 5 },
        { type: "WORK", time: 25 },
        { type: "BREAK", time: 5 },
        { type: "WORK", time: 25 },
        { type: "BREAK", time: 5 },
        { type: "WORK", time: 25 },
        { type: "LONG BREAK", time: 15 },
      ];

      let currentStep = 0;
      let timeLeft = sequence[0].time * 60;
      let pomoInterval = null;
      let isRunning = false;

      function updatePomoDisplay() {
        const mins = Math.floor(timeLeft / 60)
          .toString()
          .padStart(2, "0");
        const secs = (timeLeft % 60).toString().padStart(2, "0");
        document.getElementById("pomo-timer").innerText = `${mins}:${secs}`;

        const step = sequence[currentStep];
        const workCount = Math.floor(currentStep / 2) + 1;
        document.getElementById("pomo-status").innerText =
          step.type === "WORK" ? `WORK SESSION ${workCount}/4` : `${step.type}`;
        document.getElementById("pomo-status").style.color =
          step.type === "WORK" ? "var(--accent)" : "var(--break)";
      }

      function togglePomo() {
        if (isRunning) {
          clearInterval(pomoInterval);
          document.getElementById("pomo-start-btn").innerText = "Resume";
          document.body.classList.remove("active-pomo"); // Brighten back up
        } else {
          document.body.classList.add("active-pomo"); // Darken everything else
          pomoInterval = setInterval(() => {
            timeLeft--;
            if (timeLeft < 0) {
              nextStep();
            }
            updatePomoDisplay();
          }, 1000);
          document.getElementById("pomo-start-btn").innerText = "Pause";
        }
        isRunning = !isRunning;
      }

      function nextStep() {
        currentStep = (currentStep + 1) % sequence.length;
        timeLeft = sequence[currentStep].time * 60;
        alert(sequence[currentStep].type + " STARTING NOW");
      }

      function resetPomo() {
        clearInterval(pomoInterval);
        isRunning = false;
        currentStep = 0;
        timeLeft = sequence[0].time * 60;
        document.getElementById("pomo-start-btn").innerText = "Start Cycle";
        document.body.classList.remove("active-pomo");
        updatePomoDisplay();
      }

      // Initialize
      setInterval(updateTimer, 1000);
      updateTimer();
      updatePomoDisplay();
    </script>
  </body>
</html>
